// config.js (минимальная конфигурация по умолчанию)
module.exports = {
  // Настройки боевого пропуска
  battlePass: {
    // Если будут свои картинки для страниц — укажи тут.
    // Можно оставить пустым — код корректно отработает без картинок.
    imageUrls: {
      // Пример, если будут внешние ссылки на изображения:
      // '1-10':  'https://cdn.discordapp.com/attachments/1413853448566210682/1413983446518337668/image.png?ex=68be92f4&is=68bd4174&hm=2dff59ddb0b1acba4c1130799a8794b494e071a6909bc1f5fa0b469065120489&',
      // '11-20': 'https://example.com/bp/11-20.png',
      // ...
      // '91-100': 'https://example.com/bp/91-100.png',
    },

    // Локальные пути к изображениям страниц. Указывайте относительные пути
    // к файлам в вашем проекте (например, assets/bp/1-10.png). Если
    // оставить пустым, будет использован imageUrls либо fallback.
    imagePaths: {
      // пример заполнения:
       '1-10': 'assets/bp/1-10.png',
      // '11-20': 'assets/bp/11-20.png',
      // ...
      // '91-100': 'assets/bp/91-100.png'
    },
    progressBars: {
      // Параметры геометрии полос прогресса под новую разметку 1‑10.
      // Новая картинка имеет широкую белую область справа под инфо‑блоки,
      // поэтому горизонтальный диапазон полос уменьшен, а вертикальные смещены
      // ближе к центру строк.
      xPct: 11.0,           // отступ слева, чтобы не перекрывать надпись FREE/PREM
      widthPct: 53.11,     // ширина области полосы (5 ячеек по ~13.5% каждая)
      // Верхняя полоса (уровни 1–5) располагается в верхнем сером ряду
      top:    { yPct: 9.9, heightPct: 39.0 },
      // Нижняя полоса (уровни 6–10) располагается в нижнем сером ряду
      bottom: { yPct: 53.3, heightPct: 39.0 }
    },

    // Цвета для каждой из четырёх половинок полосы прогресса. 
    // Начиная с версии, в которой полосы разделены на бесплатную (free) и премиальную (premium) части,
    // можно задать собственные цвета для каждой половинки. Цвет задаётся как объект { r, g, b, a }.
    // Пара «top» описывает верхнюю строку уровней (1–5), «bottom» — нижнюю (6–10). 
    // Внутри каждой пары можно указать цвета для free и premium половинок. Если цвет не указан, 
    // будет использован общий цвет из переменных BP_BAR_R/G/B/ALPHA либо дефолт.
    progressBarColors: {
      top: {
        free:  { r: 60, g: 148, b: 237, a: 127 },
        premium: { r: 255, g: 63, b: 63, a: 127 }
      },
      bottom: {
        free:  { r: 60, g: 148, b: 237, a: 127 },
        premium: { r: 255, g: 63, b: 63, a: 127 }
      }
    },

    // Список наград для уровней боевого пропуска. 
    // Ключи 'free' и 'premium' содержат словарь, где ключ — номер уровня (1..100), 
    // а значение — объект с типами наград и их количеством. Пример:
    // rewards: {
    //   free: {
    //     3: { cardPacks: 1 },
    //     5: { doubleTokens: 2 },
    //     8: { rafflePoints: 1 }
    //   },
    //   premium: {
    //     3: { cardPacks: 1 },
    //     4: { cardPacks: 1 },
    //     5: { cardPacks: 1 },
    //     8: { doubleTokens: 2 },
    //     9: { rafflePoints: 1 }
    //   }
    // }
    // По умолчанию список пуст и награды не начисляются.
    // Компактная запись наград. Заполняйте только здесь — формат позволяет
    // перечислить уровни через обратный слэш или запятую, чтобы выдать одну
    // награду на несколько уровней сразу. Значение указывает количество награды
    // за каждый уровень из списка. При указании нескольких карт на разных уровнях
    // используйте один объект со всеми парами уровня:значение.
    rewardsCompact: {
      free: {
        cardPacks:    { "1\\6\\11\\15": 1 },
        doubleTokens: { "18": 1 },
        rafflePoints: { "3\\13": 1 }
      },
      premium: {
        cardPacks: {
          "10\\20": 3,
          "1\\3\\5\\7\\9\\11\\13\\15\\17\\19": 1
        },
        doubleTokens: { "8\\18": 1 },
        rafflePoints: { "4\\14": 1 }
      }
    },

    // Развёрнутый список наград. Не заполняйте вручную — будет автоматически
    // сгенерирован на основе rewardsCompact при загрузке конфига.
    rewards: null,

    // Порог XP на каждый уровень (1..100). Если оставить пустым,
    // логика сама упадёт на шаг 100 XP за уровень.
    xpThresholds: []
  },

  // Глобальный список пользователей, которым доступны все команды вне зависимости от ролей или прав. 
  // Заполняется идентификаторами Discord. Пользователи из этого списка проходят проверку в isWhitelisted().
  adminUsers: [
    "311247030422863882", // фрокенг
    "656899242593484823"  //самолёт
  ],

  // Контрольные уровни (для логов достижений)
  xp: {
    milestones: [50, 96, 100]
  }
};

// ===== Разворачивание compact-наград в подробный вид =====

/**
 * Преобразует компактную схему наград в детальную. Результат имеет вид
 * { free: { lvl: [ {type, amount}, ... ] }, premium: { ... } }.
 * На одном уровне может быть несколько наград, поэтому значения собираются
 * в массив. Уровни сортируются по возрастанию для удобства.
 *
 * @param {Object} compact Исходная схема rewardsCompact
 */
function expandRewards(compact) {
  const out = { free: {}, premium: {} };
  for (const lane of ["free", "premium"]) {
    const laneDef = (compact && compact[lane]) || {};
    for (const rewardType of Object.keys(laneDef)) {
      const mapping = laneDef[rewardType] || {};
      for (const levelsStr of Object.keys(mapping)) {
        const amt = Number(mapping[levelsStr]);
        if (!amt || isNaN(amt) || amt <= 0) continue;
        // Разделяем уровни по слешу или запятой
        const levels = String(levelsStr)
          .split(/[\\,]/g)
          .map(s => s.trim())
          .filter(Boolean)
          .map(s => Number(s))
          .filter(n => Number.isFinite(n) && n > 0);
        for (const lvl of levels) {
          if (!out[lane][lvl]) out[lane][lvl] = [];
          out[lane][lvl].push({ type: rewardType, amount: amt });
        }
      }
    }
    // сортировка уровней
    const sorted = {};
    Object.keys(out[lane])
      .map(n => Number(n))
      .sort((a, b) => a - b)
      .forEach(k => {
        sorted[k] = out[lane][k];
      });
    out[lane] = sorted;
  }
  return out;
}

// Попытка развернуть compact-награды при загрузке модуля. Если что-то
// пойдёт не так, оставляем пустой набор наград.
try {
  const cfg = module.exports;
  if (cfg.battlePass) {
    cfg.battlePass.rewards = expandRewards(cfg.battlePass.rewardsCompact);
  }
} catch (err) {
  const cfg = module.exports;
  if (cfg.battlePass) cfg.battlePass.rewards = { free: {}, premium: {} };
}
